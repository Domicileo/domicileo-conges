<!DOCTYPE html>
<!-- Domicileo – Gestion des congés payés (v25 – données préchargées) -->
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Domicileo – Gestion des congés payés</title>

<style>
:root{--primary:#0066cc;--secondary:#f3f6fb;--danger:#e53935;
--warning:#ffb300;--success:#4caf50;--text:#333;--bg:#fff;
--radius:6px;--gap:.5rem;--absent-day:#90caf9;--holiday-day:var(--warning);
--unpaid-day:#ffcc80}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,Arial,sans-serif;background:var(--secondary);color:var(--text)}
header{background:var(--primary);color:#fff;padding:1rem;text-align:center}
.container{max-width:1200px;margin:0 auto;padding:1rem}
.table-responsive{overflow-x:auto}
table{width:100%;border-collapse:collapse;margin-bottom:1rem}
th,td{padding:.4rem .6rem;border:1px solid #ccc;text-align:center;font-size:.9rem}
th{background:#eee;font-weight:600}
.row-alert{background:#fdecea}
.cell-has-days{background:var(--success);color:#fff}
.cell-unpaid{background:var(--warning);color:#000}
button,select{padding:.4rem .8rem;border:1px solid #ccc;border-radius:var(--radius);font:inherit}
button{cursor:pointer;border:none}
button.primary{background:var(--primary);color:#fff}
button.secondary{background:#ccc}
button.danger{background:var(--danger);color:#fff}
.no-print button{margin-right:var(--gap);margin-bottom:var(--gap)}
.calendar th.month{min-width:90px;cursor:pointer}
.calendar th.month:hover{background:#d0d7e4}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:1000}
.modal.show{display:flex}
.modal-content{background:var(--bg);padding:1rem;border-radius:var(--radius);max-width:500px;width:90%;max-height:90vh;overflow-y:auto}
.month-table thead th.day{width:32px}
.absent-day{background:var(--absent-day)}
.absent-holiday{background:var(--holiday-day)}
.unpaid-day{background:var(--unpaid-day)}
.wheel select{appearance:none;width:5.2rem;margin-right:.3rem;text-align:center}
@media print{header,.no-print,.modal{display:none!important}body{background:#fff}}
</style>
</head>

<body>
<header><h1>Domicileo – Gestion des congés payés</h1></header>

<div class="container">
  <div class="no-print" style="margin-bottom:var(--gap);display:flex;flex-wrap:wrap;align-items:center;gap:var(--gap)">
    <label for="yearSelect"><strong>Période&nbsp;:</strong></label>
    <select id="yearSelect"></select>
    <button id="addEmployeeBtn" class="primary">Ajouter salarié</button>
    <button id="exportCsvBtn" class="secondary">Export CSV</button>
    <button id="exportJsonBtn" class="secondary">Export JSON</button>
    <button id="printBtn" class="secondary">Imprimer / PDF</button>
  </div>

  <div class="table-responsive">
    <table id="employeeTable">
      <thead><tr><th>Salarié·e</th><th>Acquis</th><th>Pris</th><th>Restant</th><th class="no-print">Actions</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="calendar table-responsive">
    <table id="calendarTable"><thead></thead><tbody></tbody></table>
  </div>
</div>

<!-- Modale gestion individuelle -->
<div id="manageModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <h2 id="modalTitle">Gérer les congés</h2>
    <div class="wheel"><label><strong>Départ :</strong><br><select id="startDay"></select><select id="startMonth"></select><select id="startYear"></select></label></div>
    <div class="wheel" style="margin-top:.5rem"><label><strong>Retour :</strong><br><select id="endDay"></select><select id="endMonth"></select><select id="endYear"></select></label></div>
    <label style="display:block;margin:0.8rem 0"><input type="checkbox" id="unpaidCheckbox"> Sans solde</label>
    <button id="addPeriodBtn" class="primary" style="margin:1rem 0">Ajouter la période</button>
    <h3>Jours posés</h3><ul id="daysList"></ul>
    <div style="text-align:right"><button id="closeModalBtn" class="secondary">Fermer</button></div>
  </div>
</div>

<!-- Modale vue mensuelle -->
<div id="monthModal" class="modal" aria-hidden="true">
  <div class="modal-content large">
    <h2 id="monthModalTitle"></h2>
    <div class="table-responsive"><table id="monthTable" class="month-table"><thead></thead><tbody></tbody></table></div>
    <div style="text-align:right"><button id="closeMonthBtn" class="secondary">Fermer</button></div>
  </div>
</div>

<script>
/* ----------------- Configuration ----------------- */
const LS_KEY   = 'domicileo_conges_data';
const PERIOD   = '2025-2026';
const SCHEMA_V = 1;

/* ---------- RAW_DATA : tes 41 lignes ---------- */
const RAW_DATA = [
  ["ACAPANDIE, Lydia","04/08/2025","17/08/2025","Congé payé"],
  ["BALLANGER, Marion","18/08/2025","01/09/2025","Congé payé"],
  ["BARBEAU, Emmanuelle-Christine","04/07/2025","04/07/2025","Congé payé"],
  ["BARBEAU, Emmanuelle-Christine","07/07/2025","27/07/2025","Congé payé"],
  ["BAYET, Anita","18/08/2025","07/09/2025","Congé payé"],
  ["BILY, Yohann","28/07/2025","10/08/2025","Congé payé"],
  ["BOCAUX, Laetitia","04/08/2025","17/08/2025","Congé payé"],
  ["BRILLAUD, Yan","21/07/2025","03/08/2025","Congé payé"],
  ["CLUZEAU, Magali","07/07/2025","27/07/2025","Congé payé"],
  ["COUSIN, Jeanne","07/07/2025","27/07/2025","Congé payé"],
  ["COUTHOUIS, Sophie","15/07/2025","27/07/2025","Congé payé"],
  ["COUTHOUIS, Sophie","11/08/2025","17/08/2025","Congé payé"],
  ["DARD, Nathalie","18/08/2025","07/09/2025","Congé payé"],
  ["DELIAS, Nadège","07/07/2025","13/07/2025","Congé payé"],
  ["DELIAS, Nadège","28/07/2025","04/08/2025","Congé payé"],
  ["DELIAS, Nadège","14/07/2025","27/07/2025","Congé payé"],
  ["DIOP, Marie-Jeanine","15/07/2025","27/07/2025","Congé payé"],
  ["DOS ANJOS, Stéphanie","21/07/2025","10/08/2025","Congé payé"],
  ["FRANCOIS, Gaelle","28/07/2025","17/08/2025","Congé payé"],
  ["GILABERT, Laura","28/07/2025","10/08/2025","Congé payé"],
  ["GRIS, Nadeje","15/09/2025","21/09/2025","Congé payé"],
  ["GRIS, Nadeje","20/10/2025","26/10/2025","Congé payé"],
  ["GRIS, Nadeje","10/11/2025","16/11/2025","Congé payé"],
  ["GRIS, Nadeje","23/06/2025","06/07/2025","Congé payé"],
  ["HYPEAU, Magali","13/08/2025","18/08/2025","Congé sans solde"],
  ["JACQUET, Isabelle","15/07/2025","27/07/2025","Congé payé"],
  ["JOLLY, Jacky","10/06/2025","15/06/2025","Congé payé"],
  ["JOLLY, Jacky","11/08/2025","24/08/2025","Congé payé"],
  ["LAFORGUE, Julie","18/08/2025","07/09/2025","Congé payé"],
  ["MAMES, Karine","28/07/2025","10/08/2025","Congé payé"],
  ["MORCEAU, Nancy","06/06/2025","08/06/2025","Congé payé"],
  ["MORCEAU, Nancy","11/08/2025","31/08/2025","Congé payé"],
  ["NUEYE, Zoukou","28/07/2025","17/08/2025","Congé payé"],
  ["OLIVIER, Julie","28/07/2025","10/08/2025","Congé payé"],
  ["PEROCHEAU, Celine","11/08/2025","31/08/2025","Congé payé"],
  ["QUEIROS DA SILVA, Francisca","07/07/2025","27/07/2025","Congé payé"],
  ["ROUSSEAU, Mathilde","28/07/2025","03/08/2025","Congé payé"],
  ["ROUSSEAU, Mathilde","25/08/2025","07/09/2025","Congé payé"],
  ["ROY, Sophie","11/08/2025","31/08/2025","Congé payé"],
  ["SICARD, Ariane","11/08/2025","31/08/2025","Congé payé"],
  ["THIZON, Martine","28/07/2025","10/08/2025","Congé payé"]
];

/* ---------- Helpers ---------- */
const strToDate = s => {
  const [d,m,y] = s.split('/'); return new Date(`${y}-${m}-${d}`);
};
const enumerateDays = (start,end) => {
  const out=[]; for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1))
    if(d.getDay()!==0) out.push(d.toISOString().slice(0,10));
  return out;
};

/* ---------- Init store from RAW_DATA (run once) ---------- */
if(!localStorage.getItem(LS_KEY)){
  const empMap=new Map(), employees=[], records={};
  RAW_DATA.forEach(([rawName,deb,fin,motif])=>{
    // remet "NOM, Prénom" ➜ "Prénom Nom"
    const name = rawName.includes(',')
      ? rawName.split(',').reverse().map(s=>s.trim()).join(' ')
      : rawName.trim();
    if(!empMap.has(name)){
      empMap.set(name, 'e'+(empMap.size+1));
      employees.push({id:empMap.get(name), name, joined:2025});
    }
    const id=empMap.get(name);
    records[id]??={days:[], unpaid:[]};
    const days=enumerateDays(strToDate(deb),strToDate(fin));
    (motif.toLowerCase().includes('sans')?records[id].unpaid:records[id].days).push(...days);
  });

  const initial={
    schemaVersion:SCHEMA_V,
    employees,
    records:{[PERIOD]:records}
  };
  localStorage.setItem(LS_KEY,JSON.stringify(initial));
}

/* ---------- App code (render, boutons, etc.) ---------- */
/*  (Tout le reste de l’app : sélection d’année, renderEmployees,
    renderCalendar, gestion modales — inchangé par rapport à ta version
    précédente. Raccourci ici pour clarté.)                                    */

</script>
</body>
</html>
